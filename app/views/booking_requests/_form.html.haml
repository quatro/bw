= simple_form_for model do |f|

  .row.mb-2
    .col-sm-12
      - if model.errors.any?
        .alert.alert-danger
          #{model.errors.full_messages.join(', ')}


      =f.input :tenant_id, as: :hidden
      =f.input :assignee_id, as: :hidden

      - if model.new_record?
        =f.input :client_id, as: :select, collection: current_user.active_tenant.clients, include_blank: false
        =f.input :requestor_id, as: :select, collection: []

      - else
        =f.input :requestor_id, as: :hidden
        =f.input :client_id, as: :hidden

      =f.input :date_from, as: :string, input_html:{class:'datepicker'}
      =f.input :date_to, as: :string, input_html:{class:'datepicker'}
      =f.input :city
      =f.input :state, collection: states
      =f.input :zip
      =f.input :reason
      =f.input :job_identifier

  .row.mb-2
    .col-sm-6
      =f.submit form_submit_label(model), class: 'btn btn-success'


:javascript


  function refresh_user_list() {

    // Identify users for the client
    $.ajax({
      url: "#{client_users_users_path}",
      data: {
        client_id: $('#booking_request_client_id').val()
      },
      success: function(data) {

        html = '';

        $.each(data, function(item,i){
          html += "<option value='" + i.id + "'>" + i.email + "</option>";
        });

        $('#booking_request_requestor_id').html(html);
      }
    });
  }

  var ready = function() {
  $('.datepicker').datepicker({
    dateFormat:"yy-mm-dd"
    });

    refresh_user_list();

    $('#booking_request_client_id').on('change', function(e){
      refresh_user_list();
    });
  }

  $(document).ready(ready);